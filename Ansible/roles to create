#install on all K3s VM's
sudo apt-get install openvswitch-switch -y
sudo apt install open-iscsi

#enable qemu guest agent on all VMs

sudo nano /etc/netplan/50-cloud-init.yaml
sudo netplan apply

# install docker on Rancher VM
sudo apt install docker.io -y
sudo docker run --privileged -d --restart=unless-stopped -p 80:80 -p 443:443 rancher/rancher
sudo docker ps
sudo docker logs  container-id  2>&1 | grep "Bootstrap Password:"

#install fluxcd
curl -s https://fluxcd.io/install.sh | sudo bash
flux check --pre
flux bootstrap github \
  --components-extra=image-reflector-controller,image-automation-controller \
  --owner=thesabear \
  --repository=flux \
  --branch=main \
  --path=clusters/home \
  --personal \
  --token-auth

  network:
  version: 2
  renderer: networkd
  ethernets:
     enp5s0:
        dhcp4: no
        addresses: [10.27.27.21/24]
        nameservers:
           addresses: [10.27.27.1]
        routes:
            - to: default
              via: 10.27.27.1
